---
title: "Sprint Bioenergetic Model"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Sprint Bioenergetic Model}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(runrgetics)
library(ggplot2)
library(dplyr)
```

The previous vignettes `sprint energetics exploration` and `sprint model formalisation` explore the functions that can represent the energy pathways in sprints and the set of parameters that can be chosen such that the functions apply on all three distances for men and women sprint performances. 

This vignette assembles the three functions into a bioenergetic model of sprint that can be used to quantify the instantaneoues energy contribution of the three energy pathways during a sprint. The model is described in details in Briand et al. 2025.

We can use the male 100 m sprint data from the Graubner and Nixdorf (2023) dataset to illustrate the possible applications of the sprint bioenergetic model.

Supposing that the maximal alactic power attained during the sprint is of 150 W/kg and that the maximal lactic power attained during the sprint is of 50 W/kg, we can use the function `sprint_bioenergetic_model` to compute the total metabolic power during the sprint.

```{r}

# Setting, time, maximal_alactic_power and maximal_lactic_power
time <- seq(0, 9.58, by = 0.01)
maximal_alactic_power <- 150
maximal_lactic_power <- 50

# applying the sprint_bioenergetic_model function to get total metabolic power

total_power <- sprint_bioenergetic_model(time, maximal_alactic_power, maximal_lactic_power)

# plot total power as a function of time

ggplot2::ggplot(data = tibble::tibble(time = time, total_power = total_power), aes(x = time, y = total_power)) +
  ggplot2::geom_line(linewidth = 1.5) +
  ggplot2::labs(title = "Total Metabolic Power during a Sprint",
       x = "Time (s)",
       y = "Total Power (W/kg)") +
  ggplot2::theme_minimal()


```

The `output` argument of the function `sprint_bioenergetic_model` allows to compute the contribution of each energy pathway to the total metabolic power. For example, we can compute the alactic power contribution during the sprint as follows:

```{r}

# applying the sprint_bioenergetic_model function to get total metabolic power

alactic_power <- sprint_bioenergetic_model(time, maximal_alactic_power, maximal_lactic_power, output = "alactic power")

# plot total power as a function of time

ggplot2::ggplot(data = tibble::tibble(time = time, alactic_power = alactic_power), aes(x = time, y = alactic_power)) +
  ggplot2::geom_line(color = "darkred", linewidth = 1.5) +
  ggplot2::labs(title = "Alactic Power during a Sprint",
       x = "Time (s)",
       y = "Alactic Power (W/kg)") +
  ggplot2::theme_minimal()


```


## Extracting Sprint Maximal Alactic and Maximal Lactic from Sprint Motion Data

The previous examples relied on rough guesses of the sprint maximal alactic and maximal lactic power. The function `fit_sprint_bioenergetic_model` can be used to fit the sprint bioenergetic model to the sprint motion data and extract the maximal alactic and maximal lactic power.

The following example shows how to derive sprint motion data from the Graubner and Nixdorf (2011) dataset and fit the sprint bioenergetic model to the data to extract the sprint maximal alactic and maximal lactic power. The functions `sprint_bioenergetic_model_max_al` and `sprint_bioenergetic_model_max_la` are used to extract both paramters.

```{r}
# Extract Bolt's 100 m data from Graubner and Nixdorf data set. 
bolt_100m <- graubner_nixdorf_sprints |>
  dplyr::filter(
    athlete == "Bolt",
    event == "Men's 100 m"
  )

# Compute sprint motion data

bolt_100m_motion_data <- sprint_motion_model_data(
  mean_velocity_splits = bolt_100m$velocity,
  time_splits = bolt_100m$splits,
  distance = bolt_100m$distance,
  reaction_time = bolt_100m$reaction_time[1],
  maximal_velocity = bolt_100m$maximal_velocity[1]
)

# extract maximal alactic and maximal lactic powers

maximal_alactic_power <- sprint_bioenergetic_model_max_al(bolt_100m_motion_data)
maximal_alactic_power

maximal_lactic_power <- sprint_bioenergetic_model_max_la(bolt_100m_motion_data)
maximal_lactic_power

```

As presented in Briand et al. (2025), for elite sprinters available in the Graubner and Nixdrof (2011) dataset, the maximal aerobic power can be estimated to be 24.5 W/kg for male sprinters and 21 W/kg for female sprinter. The default parameter was set at 24.5 W/kg for the maximal aerobic power. When dealing with female athletes' performances, the maximal aerobic power can be adjusted accordingly. 

The following example derived Fraser-Pryce's 100 m maximal alactic and maximal lactic power from the Graubner and Nixdorf (2011) dataset.

```{r}
# Extract Bolt's 100 m data from Graubner and Nixdorf data set. 
FP_100m <- graubner_nixdorf_sprints |>
  dplyr::filter(
    event == "Women's 100 m"
  )

# Compute sprint motion data

FP_100m_motion_data <- sprint_motion_model_data(
  mean_velocity_splits =FP_100m$velocity,
  time_splits = FP_100m$splits,
  distance = FP_100m$distance,
  reaction_time = FP_100m$reaction_time[1],
  maximal_velocity = FP_100m$maximal_velocity[1]
)

# extract maximal alactic and maximal lactic powers

maximal_alactic_power <- sprint_bioenergetic_model_max_al(FP_100m_motion_data, maximal_aerobic_power = 21)
maximal_alactic_power

maximal_lactic_power <- sprint_bioenergetic_model_max_la(FP_100m_motion_data, maximal_aerobic_power = 21)
maximal_lactic_power
```

From the sprint motion data extracted from the Graubner and Nixdorf data set, the function `sprint_bioenergetic_model_data` can be used to add columns to the sprint motion data, representing the energy from the 3 energy pathways as well as the total metabolic power computed from the model. 

```{r}
bolt_modeled_data <- sprint_bioenergetic_model_data(bolt_100m_motion_data)

head(bolt_modeled_data)

```


## Visualising the Sprint Bioenergetic Model Compared to Sprint Motion Data

The function `plot_sprint_bioenergetic_model` can be used to visualise the power derived sprint bioenergetic model compared to the metabolic power available in the sprint motion data, derived using di Pampero et al. (2005, 2018) approach. The following example plots the sprint bioenergetic model compared to the sprint motion data for Bolt's 100 m sprint. 

```{r}
plot_sprint_bioenergetic_model(
  sprint_motion_data = bolt_100m_motion_data
)

```

The same function can be used to plot the sprint bioenergetic model compared to the sprint motion data for Fraser-Pryce's 100 m sprint, specifying a maximal aerobic power of 21 W/kg. The y-axis scale can also be adjusted using the `scale_max_power` argument, which is set by default at 160 W/kg.

```{r}
plot_sprint_bioenergetic_model(
  sprint_motion_data = FP_100m_motion_data,
  maximal_aerobic_power = 21,
  scale_max_power = 110
)
```

